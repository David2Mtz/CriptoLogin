<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Hospedaje en Ciudad de México</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAY0wzQDOjgf_KCbiat_rDUzQi_g_v7A3s&libraries=places"></script>
    <style>
        #map {
            height: 70vh;
            width: 100%;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #controls {
            padding: 10px;
            background: #f4f4f4;
        }
        #results {
            max-height: 20vh;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <h1>Buscar Sitio de Hospedaje</h1>
        <input type="text" id="search-input" placeholder="Escribe el nombre del hospedaje" style="width: 60%; padding: 8px;">
        <button id="search-button" style="padding: 8px 16px;">Buscar</button>
    </div>
    <div id="map"></div>
    <div id="results"></div>

    <script>
        let map;
        let service;
        let markers = [];

        function initMap() {
            // Coordenadas del centro de Ciudad de México
            const cdmx = { lat: 19.432608, lng: -99.133209 };

            // Inicializa el mapa
            map = new google.maps.Map(document.getElementById("map"), {
                center: cdmx,
                zoom: 14,
            });

            // Inicializa el servicio de Places
            service = new google.maps.places.PlacesService(map);

            // Configura el botón de búsqueda
            document.getElementById("search-button").addEventListener("click", performSearch);
        }

        function performSearch() {
            const query = document.getElementById("search-input").value;

            if (!query.trim()) {
                alert("Por favor, escribe el nombre de un hospedaje para buscar.");
                return;
            }

            // Realiza la búsqueda por texto
            const request = {
                query: query,
                fields: ["name", "geometry", "formatted_address", "rating", "user_ratings_total", "types"],
                locationBias: { lat: 19.432608, lng: -99.133209 }, // Enfoca la búsqueda en CDMX
            };

            service.findPlaceFromQuery(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                    // Filtrar solo los resultados que sean tipo "lodging"
                    const lodgingResults = results.filter(place => place.types && place.types.includes("lodging"));

                    if (lodgingResults.length > 0) {
                        displayResults(lodgingResults);
                    } else {
                        alert("No se encontraron lugares de hospedaje con el nombre ingresado.");
                    }
                } else {
                    alert("No se encontraron resultados para tu búsqueda.");
                }
            });
        }

        function displayResults(places) {
            // Limpia marcadores y resultados anteriores
            clearMarkers();
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            places.forEach((place) => {
                // Añade marcador al mapa
                const marker = new google.maps.Marker({
                    position: place.geometry.location,
                    map: map,
                    title: place.name,
                });
                markers.push(marker);

                // Centra el mapa en el lugar encontrado
                map.setCenter(place.geometry.location);

                // Muestra información en la lista de resultados
                const placeInfo = document.createElement("div");
                placeInfo.innerHTML = `
                    <strong>${place.name}</strong><br>
                    Dirección: ${place.formatted_address || "N/A"}<br>
                    Calificación: ${place.rating || "Sin calificación"} (${place.user_ratings_total || 0} reseñas)
                `;
                placeInfo.style.marginBottom = "10px";
                resultsDiv.appendChild(placeInfo);
            });
        }

        function clearMarkers() {
            // Elimina los marcadores del mapa
            markers.forEach((marker) => marker.setMap(null));
            markers = [];
        }

        // Inicializa el mapa cuando se carga la página
        window.onload = initMap;
    </script>
</body>
</html>
